<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Currículos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
            margin: 20px auto;
            max-width: 900px;
        }
        
        .header-title {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .section-title {
            color: #764ba2;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            transition: transform 0.2s;
        }
        
        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-remove {
            background: #dc3545;
            border: none;
            color: white;
        }
        
        .dynamic-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 40px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .alert-custom {
            border-radius: 10px;
            border: none;
        }
        
        .idade-display {
            font-weight: 600;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <div class="text-center mb-4">
                <h1 class="header-title"><i class="fas fa-file-alt"></i> Gerador de Currículos</h1>
                <p class="text-muted">Preencha seus dados e gere seu currículo profissional em PDF</p>
            </div>
            
            <div id="alertContainer"></div>
            
            <form id="curriculoForm">
                <!-- Dados Pessoais -->
                <h3 class="section-title"><i class="fas fa-user"></i> Dados Pessoais</h3>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" class="form-control" id="nome_completo" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Telefone *</label>
                        <input type="tel" class="form-control" id="telefone" placeholder="(00) 00000-0000" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-control" id="data_nascimento">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Idade</label>
                        <input type="text" class="form-control idade-display" id="idade" readonly>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-8">
                        <label class="form-label">Endereço</label>
                        <input type="text" class="form-control" id="endereco">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">CEP</label>
                        <input type="text" class="form-control" id="cep" placeholder="00000-000">
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Cidade</label>
                        <input type="text" class="form-control" id="cidade">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Estado</label>
                        <select class="form-select" id="estado">
                            <option value="">Selecione</option>
                            <option value="AC">AC</option>
                            <option value="AL">AL</option>
                            <option value="AP">AP</option>
                            <option value="AM">AM</option>
                            <option value="BA">BA</option>
                            <option value="CE">CE</option>
                            <option value="DF">DF</option>
                            <option value="ES">ES</option>
                            <option value="GO">GO</option>
                            <option value="MA">MA</option>
                            <option value="MT">MT</option>
                            <option value="MS">MS</option>
                            <option value="MG">MG</option>
                            <option value="PA">PA</option>
                            <option value="PB">PB</option>
                            <option value="PR">PR</option>
                            <option value="PE">PE</option>
                            <option value="PI">PI</option>
                            <option value="RJ">RJ</option>
                            <option value="RN">RN</option>
                            <option value="RS">RS</option>
                            <option value="RO">RO</option>
                            <option value="RR">RR</option>
                            <option value="SC">SC</option>
                            <option value="SP">SP</option>
                            <option value="SE">SE</option>
                            <option value="TO">TO</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Estado Civil</label>
                        <select class="form-select" id="estado_civil">
                            <option value="">Selecione</option>
                            <option value="Solteiro(a)">Solteiro(a)</option>
                            <option value="Casado(a)">Casado(a)</option>
                            <option value="Divorciado(a)">Divorciado(a)</option>
                            <option value="Viúvo(a)">Viúvo(a)</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Objetivo Profissional</label>
                    <textarea class="form-control" id="objetivo" rows="3"></textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Resumo Profissional</label>
                    <textarea class="form-control" id="resumo_profissional" rows="4"></textarea>
                </div>
                
                <!-- Experiências Profissionais -->
                <h3 class="section-title"><i class="fas fa-briefcase"></i> Experiências Profissionais</h3>
                <div id="experienciasContainer"></div>
                <button type="button" class="btn btn-add mb-4" onclick="adicionarExperiencia()">
                    <i class="fas fa-plus"></i> Adicionar Experiência
                </button>
                
                <!-- Formação Acadêmica -->
                <h3 class="section-title"><i class="fas fa-graduation-cap"></i> Formação Acadêmica</h3>
                <div id="formacoesContainer"></div>
                <button type="button" class="btn btn-add mb-4" onclick="adicionarFormacao()">
                    <i class="fas fa-plus"></i> Adicionar Formação
                </button>
                
                <!-- Habilidades -->
                <h3 class="section-title"><i class="fas fa-star"></i> Habilidades</h3>
                <div id="habilidadesContainer"></div>
                <button type="button" class="btn btn-add mb-4" onclick="adicionarHabilidade()">
                    <i class="fas fa-plus"></i> Adicionar Habilidade
                </button>
                
                <!-- Botão Submit -->
                <div class="text-center mt-5">
                    <button type="submit" class="btn btn-primary btn-submit btn-lg">
                        <i class="fas fa-file-pdf"></i> Gerar Currículo em PDF
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <script>
        let expCount = 0;
        let formCount = 0;
        let habCount = 0;
        
        // Calcular idade automaticamente
        document.getElementById('data_nascimento').addEventListener('change', function() {
            const dataNasc = new Date(this.value);
            const hoje = new Date();
            let idade = hoje.getFullYear() - dataNasc.getFullYear();
            const mes = hoje.getMonth() - dataNasc.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < dataNasc.getDate())) {
                idade--;
            }
            
            document.getElementById('idade').value = idade + ' anos';
        });
        
        // Adicionar Experiência
        function adicionarExperiencia() {
            expCount++;
            const html = `
                <div class="dynamic-section" id="exp_${expCount}">
                    <div class="d-flex justify-content-between mb-3">
                        <h5><i class="fas fa-building"></i> Experiência ${expCount}</h5>
                        <button type="button" class="btn btn-sm btn-remove" onclick="removerElemento('exp_${expCount}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <label class="form-label">Empresa</label>
                            <input type="text" class="form-control" name="exp_empresa[]">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Cargo</label>
                            <input type="text" class="form-control" name="exp_cargo[]">
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-5">
                            <label class="form-label">Data Início</label>
                            <input type="date" class="form-control" name="exp_data_inicio[]">
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">Data Fim</label>
                            <input type="date" class="form-control" name="exp_data_fim[]" id="exp_data_fim_${expCount}">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Atual</label>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" name="exp_atual[]" value="1" 
                                       onchange="toggleDataFim(${expCount})">
                            </div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-control" name="exp_descricao[]" rows="2"></textarea>
                    </div>
                </div>
            `;
            $('#experienciasContainer').append(html);
        }
        
        // Adicionar Formação
        function adicionarFormacao() {
            formCount++;
            const html = `
                <div class="dynamic-section" id="form_${formCount}">
                    <div class="d-flex justify-content-between mb-3">
                        <h5><i class="fas fa-school"></i> Formação ${formCount}</h5>
                        <button type="button" class="btn btn-sm btn-remove" onclick="removerElemento('form_${formCount}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-8">
                            <label class="form-label">Instituição</label>
                            <input type="text" class="form-control" name="form_instituicao[]">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Nível</label>
                            <select class="form-select" name="form_nivel[]">
                                <option value="Ensino Médio">Ensino Médio</option>
                                <option value="Técnico">Técnico</option>
                                <option value="Graduação">Graduação</option>
                                <option value="Pós-graduação">Pós-graduação</option>
                                <option value="Mestrado">Mestrado</option>
                                <option value="Doutorado">Doutorado</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-12">
                            <label class="form-label">Curso</label>
                            <input type="text" class="form-control" name="form_curso[]">
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <label class="form-label">Data Início</label>
                            <input type="date" class="form-control" name="form_data_inicio[]">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Data Fim</label>
                            <input type="date" class="form-control" name="form_data_fim[]">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="form_status[]">
                                <option value="Concluído">Concluído</option>
                                <option value="Em andamento">Em andamento</option>
                                <option value="Trancado">Trancado</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            $('#formacoesContainer').append(html);
        }
        
        // Adicionar Habilidade
        function adicionarHabilidade() {
            habCount++;
            const html = `
                <div class="dynamic-section" id="hab_${habCount}">
                    <div class="d-flex justify-content-between mb-3">
                        <h5><i class="fas fa-lightbulb"></i> Habilidade ${habCount}</h5>
                        <button type="button" class="btn btn-sm btn-remove" onclick="removerElemento('hab_${habCount}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-5">
                            <label class="form-label">Nome da Habilidade</label>
                            <input type="text" class="form-control" name="hab_nome[]">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Nível</label>
                            <select class="form-select" name="hab_nivel[]">
                                <option value="Básico">Básico</option>
                                <option value="Intermediário">Intermediário</option>
                                <option value="Avançado">Avançado</option>
                                <option value="Especialista">Especialista</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tipo</label>
                            <select class="form-select" name="hab_tipo[]">
                                <option value="Técnica">Técnica</option>
                                <option value="Comportamental">Comportamental</option>
                                <option value="Idioma">Idioma</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            $('#habilidadesContainer').append(html);
        }
        
        // Remover elemento
        function removerElemento(id) {
            $(`#${id}`).fadeOut(300, function() {
                $(this).remove();
            });
        }
        
        // Toggle data fim quando marcar "atual"
        function toggleDataFim(id) {
            const dataFim = document.getElementById(`exp_data_fim_${id}`);
            const checkbox = event.target;
            
            if (checkbox.checked) {
                dataFim.disabled = true;
                dataFim.value = '';
            } else {
                dataFim.disabled = false;
            }
        }
        
        // Mostrar alerta
        function mostrarAlerta(mensagem, tipo) {
            const alertHtml = `
                <div class="alert alert-${tipo} alert-custom alert-dismissible fade show" role="alert">
                    <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${mensagem}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            $('#alertContainer').html(alertHtml);
            
            // Scroll para o topo
            $('html, body').animate({ scrollTop: 0 }, 300);
        }
        
        // Submit do formulário
        $('#curriculoForm').on('submit', function(e) {
            e.preventDefault();
            
            // Coletar dados
            const dados = {
                nome_completo: $('#nome_completo').val(),
                email: $('#email').val(),
                telefone: $('#telefone').val(),
                endereco: $('#endereco').val(),
                cidade: $('#cidade').val(),
                estado: $('#estado').val(),
                cep: $('#cep').val(),
                data_nascimento: $('#data_nascimento').val(),
                estado_civil: $('#estado_civil').val(),
                objetivo: $('#objetivo').val(),
                resumo_profissional: $('#resumo_profissional').val(),
                experiencias: [],
                formacoes: [],
                habilidades: []
            };
            
            // Coletar experiências
            $('[name="exp_empresa[]"]').each(function(index) {
                if ($(this).val()) {
                    dados.experiencias.push({
                        empresa: $(this).val(),
                        cargo: $('[name="exp_cargo[]"]').eq(index).val(),
                        data_inicio: $('[name="exp_data_inicio[]"]').eq(index).val(),
                        data_fim: $('[name="exp_data_fim[]"]').eq(index).val(),
                        descricao: $('[name="exp_descricao[]"]').eq(index).val(),
                        atual: $('[name="exp_atual[]"]').eq(index).is(':checked') ? 1 : 0
                    });
                }
            });
            
            // Coletar formações
            $('[name="form_instituicao[]"]').each(function(index) {
                if ($(this).val()) {
                    dados.formacoes.push({
                        instituicao: $(this).val(),
                        curso: $('[name="form_curso[]"]').eq(index).val(),
                        nivel: $('[name="form_nivel[]"]').eq(index).val(),
                        data_inicio: $('[name="form_data_inicio[]"]').eq(index).val(),
                        data_fim: $('[name="form_data_fim[]"]').eq(index).val(),
                        status: $('[name="form_status[]"]').eq(index).val()
                    });
                }
            });
            
            // Coletar habilidades
            $('[name="hab_nome[]"]').each(function(index) {
                if ($(this).val()) {
                    dados.habilidades.push({
                        nome: $(this).val(),
                        nivel: $('[name="hab_nivel[]"]').eq(index).val(),
                        tipo: $('[name="hab_tipo[]"]').eq(index).val()
                    });
                }
            });
            
            // Enviar para o backend
            $.ajax({
                url: './api/processar_curriculo.php',
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(dados),
                success: function(response) {
                    console.log('Resposta do servidor:', response);
                    
                    if (response.sucesso) {
                        mostrarAlerta('Currículo criado com sucesso!', 'success');
                        
                        // Gerar PDF após 1 segundo
                        setTimeout(function() {
                            window.location.href = './api/gerar_pdf.php?id=' + response.curriculo_id;
                        }, 1000);
                    } else {
                        mostrarAlerta(response.erro || 'Erro desconhecido', 'danger');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Erro AJAX:', xhr, status, error);
                    console.error('Response Text:', xhr.responseText);
                    
                    let mensagemErro = 'Erro ao processar currículo';
                    
                    if (xhr.responseJSON && xhr.responseJSON.erro) {
                        mensagemErro = xhr.responseJSON.erro;
                    } else if (xhr.responseText) {
                        mensagemErro = xhr.responseText;
                    }
                    
                    mostrarAlerta(mensagemErro, 'danger');
                }
            });
        });
        
        // Adicionar pelo menos um de cada ao carregar
        $(document).ready(function() {
            adicionarExperiencia();
            adicionarFormacao();
            adicionarHabilidade();
        });
    </script>
</body>
</html>